name: 'Professor Code Review'
description: 'AI-Powered Code Review & Quality Oversight'
author: 'Professor Team'

branding:
  icon: 'check-circle'
  color: 'blue'

inputs:
  github-token:
    description: 'GitHub token for API access'
    required: true
  anthropic-api-key:
    description: 'Anthropic API key for Claude'
    required: false
  openai-api-key:
    description: 'OpenAI API key for GPT'
    required: false
  provider:
    description: 'LLM provider (anthropic or openai)'
    required: false
    default: 'anthropic'
  model:
    description: 'Model to use'
    required: false
    default: 'claude-3-5-sonnet-20240620'
  min-severity:
    description: 'Minimum severity to report (critical, high, medium, low, info)'
    required: false
    default: 'medium'
  max-files:
    description: 'Maximum files to review'
    required: false
    default: '50'
  post-comments:
    description: 'Post review comments to PR'
    required: false
    default: 'false'

runs:
  using: 'composite'
  steps:
    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'

    - name: Install Professor
      shell: bash
      run: |
        pip install --upgrade pip
        pip install pydantic pydantic-settings click rich structlog pyyaml python-dotenv PyGithub anthropic openai langchain

    - name: Checkout Professor
      uses: actions/checkout@v4
      with:
        repository: ${{ github.action_repository }}
        path: professor-repo

    - name: Run Professor
      shell: bash
      env:
        GITHUB_TOKEN: ${{ inputs.github-token }}
        ANTHROPIC_API_KEY: ${{ inputs.anthropic-api-key }}
        OPENAI_API_KEY: ${{ inputs.openai-api-key }}
        DEFAULT_LLM_PROVIDER: ${{ inputs.provider }}
        DEFAULT_LLM_MODEL: ${{ inputs.model }}
        MAX_REVIEW_FILES: ${{ inputs.max-files }}
        PYTHONPATH: ${{ github.workspace }}/professor-repo/src
      run: |
        python -m professor.cli.main review \
          --owner "${{ github.repository_owner }}" \
          --repo "${{ github.event.repository.name }}" \
          --pr-number "${{ github.event.pull_request.number }}" \
          --min-severity "${{ inputs.min-severity }}"
